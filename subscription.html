<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý gói đăng ký - HKSpace SaaS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="custom.css">
    <style>
        .status-active-recurring {
            border-left: 4px solid var(--success);
        }
        .status-active-no-recurring {
            border-left: 4px solid var(--warning);
        }
        .status-ended {
            border-left: 4px solid var(--error);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="landing-page.html" class="navbar-brand">HKSpace</a>
            <ul class="navbar-nav">
                <li><a href="landing-page.html">Bảng giá</a></li>
                <li><a href="subscription.html" class="active">Gói đăng ký</a></li>
                <li><a href="checkout.html">Thanh toán</a></li>
                <li><a href="payment.html">Cổng thanh toán</a></li>
            </ul>
            <div class="user-profile">
                <div class="user-avatar">AP</div>
                <span>Anh Phan</span>
            </div>
        </div>
    </nav>

    <div class="container mt-5 mb-5">
        <!-- Header -->
        <div class="mb-4">
            <h1 class="mb-2">Quản lý gói đăng ký</h1>
            <p class="text-secondary">Xem và quản lý thông tin gói đăng ký của bạn</p>
        </div>
        
        <div class="row">
            <!-- Left Column: Account Information -->
            <div class="col-md-8">
                <!-- Account Status: Active & Recurring -->
                <div class="card status-active-recurring" id="status-active-recurring">
                    <div class="card-header">
                        <h3 class="mb-0">Thông tin tài khoản (Đang hoạt động & Tự động gia hạn)</h3>
                    </div>
                    <div class="p-3">
                        <p class="mb-3">
                            Bạn đang đăng ký vào gói <strong>'Basic'</strong> dùng thử trong vòng <strong>15 ngày</strong>. 
                            Còn <strong>10 ngày</strong> nữa là sẽ kết thúc dùng thử và hóa đơn tiếp theo sẽ là <strong>$10 (2 seat)</strong> vào ngày <strong>15/10/2025</strong>
                        </p>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-secondary" onclick="stopSubscription()">Ngừng đăng ký</button>
                            <button class="btn btn-primary" onclick="changePlan()">Đổi gói</button>
                            <button class="btn btn-outline" style="border-color: var(--error); color: var(--error);" onclick="cancelSubscription()">Hủy</button>
                        </div>
                    </div>
                </div>
                
                <!-- Account Status: Active & No Recurring -->
                <div class="card status-active-no-recurring d-none" id="status-active-no-recurring">
                    <div class="card-header">
                        <h3 class="mb-0">Thông tin tài khoản (Đang hoạt động & Không tự động gia hạn)</h3>
                    </div>
                    <div class="p-3">
                        <p class="mb-3">
                            Bạn đang đăng ký vào gói <strong>'Basic'</strong> dùng thử trong vòng <strong>15 ngày</strong>. 
                            Còn <strong>10 ngày</strong> nữa là sẽ kết thúc dùng thử và hết hạn vào ngày <strong>15/10/2025</strong>. 
                            Vui lòng đăng ký lại để tiếp tục sử dụng dịch vụ.
                        </p>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-primary" onclick="resubscribe()">Đăng ký lại</button>
                            <button class="btn btn-secondary" onclick="changePlan()">Đổi gói</button>
                            <button class="btn btn-outline" style="border-color: var(--error); color: var(--error);" onclick="cancelSubscription()">Hủy</button>
                        </div>
                    </div>
                </div>
                
                <!-- Account Status: Ended -->
                <div class="card status-ended d-none" id="status-ended">
                    <div class="card-header">
                        <h3 class="mb-0">Thông tin tài khoản (Đã hết hạn)</h3>
                    </div>
                    <div class="p-3">
                        <p class="mb-3">
                            Bạn chưa đăng ký gói nào. Hiện tại không thể sử dụng dịch vụ.<br>
                            Vui lòng chọn gói phù hợp và đăng ký để bắt đầu sử dụng.
                        </p>
                        <a href="landing-page.html" class="btn btn-primary">Chọn gói</a>
                    </div>
                </div>
                
                <!-- Seat Information -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="mb-0">Thông tin seat: Bạn đang đăng ký <span id="total-seats">2</span> seats trong tài khoản</h3>
                    </div>
                    <div class="p-0">
                        <table class="seat-table">
                            <thead>
                                <tr>
                                    <th>Người dùng</th>
                                    <th>Số lượng seat</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Hoàng Anh</td>
                                    <td>1 seat</td>
                                    <td>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm btn-secondary" onclick="removeUser('hoang-anh')">Xóa người dùng</button>
                                            <button class="btn btn-sm btn-outline" onclick="removeSeat('hoang-anh')">Xóa seat</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Seat trống</td>
                                    <td>1 seat</td>
                                    <td>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm btn-primary" onclick="assignUser('empty-1')">Gán người dùng</button>
                                            <button class="btn btn-sm btn-outline" onclick="removeSeat('empty-1')">Xóa seat</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="p-3 border-top">
                        <button class="btn btn-primary" onclick="addSeat()">Thêm seat</button>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Invoice/Status -->
            <div class="col-md-4">
                <!-- Payment Success Invoice -->
                <div class="invoice-card" id="invoice-success">
                    <div class="invoice-title">Basic</div>
                    <div class="invoice-details">
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Dùng thử</span>
                            <span class="invoice-details-item-value">15 ngày</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Giá</span>
                            <span class="invoice-details-item-value">$15/thành viên/tháng</span>
                        </div>
                    </div>
                    <div class="invoice-details mt-3">
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Tối đa member</span>
                            <span class="invoice-details-item-value">1,000</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">AI Basic</span>
                            <span class="invoice-details-item-value">Có</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Hỗ trợ 24/7</span>
                            <span class="invoice-details-item-value">Có</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Blocks</span>
                            <span class="invoice-details-item-value">Không giới hạn</span>
                        </div>
                    </div>
                    <div class="invoice-total">
                        <span class="invoice-total-label">Tổng cộng</span>
                        <span class="invoice-total-value">$0</span>
                    </div>
                    <div class="mt-3 pt-3 border-top">
                        <small class="text-secondary">
                            Hóa đơn tiếp theo: $10 (1 seat) sẽ được thanh toán tự động vào ngày 15/10/2025
                        </small>
                    </div>
                    <div class="mt-3">
                        <span class="badge badge-success">Đã thanh toán</span>
                    </div>
                </div>
                
                <!-- Payment Failed Invoice -->
                <div class="invoice-card d-none" id="invoice-failed">
                    <div class="alert alert-error mb-3">
                        <strong>Lỗi</strong> (Thanh toán lần cuối thất bại)
                    </div>
                    <div class="invoice-title">Basic</div>
                    <div class="invoice-details">
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Dùng thử</span>
                            <span class="invoice-details-item-value">15 ngày</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Giá</span>
                            <span class="invoice-details-item-value">$15/thành viên/tháng</span>
                        </div>
                    </div>
                    <div class="invoice-details mt-3">
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Tối đa member</span>
                            <span class="invoice-details-item-value">1,000</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">AI Basic</span>
                            <span class="invoice-details-item-value">Có</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Hỗ trợ 24/7</span>
                            <span class="invoice-details-item-value">Có</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Blocks</span>
                            <span class="invoice-details-item-value">Không giới hạn</span>
                        </div>
                    </div>
                    <div class="invoice-total">
                        <span class="invoice-total-label">Tổng cộng</span>
                        <span class="invoice-total-value">$0</span>
                    </div>
                    <div class="mt-3">
                        <span class="badge badge-warning">Mới</span>
                    </div>
                    <button class="btn btn-primary w-100 mt-3" onclick="retryPayment()">
                        Thanh toán lại
                    </button>
                </div>
                
                <!-- Renew Invoice (Auto Charge) -->
                <div class="invoice-card d-none" id="invoice-renew-auto">
                    <div class="invoice-title">(Invoice) Gia hạn gói Basic</div>
                    <div class="invoice-details">
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Phí</span>
                            <span class="invoice-details-item-value">$20</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Thanh toán</span>
                            <span class="invoice-details-item-value">TT tự động</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Trạng thái</span>
                            <span class="invoice-details-item-value">Mới</span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-top">
                        <p class="text-secondary mb-0" style="font-size: 14px;">
                            Sẽ tự động thanh toán vào ngày 15/10 bằng thẻ *****004
                        </p>
                    </div>
                    <button class="btn btn-secondary w-100 mt-3" onclick="stopSubscription()">
                        Ngừng đăng ký
                    </button>
                </div>
                
                <!-- Renew Invoice (No Auto Charge) -->
                <div class="invoice-card d-none" id="invoice-renew-manual">
                    <div class="invoice-title">(Invoice) Gia hạn gói Basic</div>
                    <div class="invoice-details">
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Phí</span>
                            <span class="invoice-details-item-value">$20</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Thanh toán</span>
                            <span class="invoice-details-item-value">TT tự động</span>
                        </div>
                        <div class="invoice-details-item">
                            <span class="invoice-details-item-label">Trạng thái</span>
                            <span class="invoice-details-item-value">Mới</span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-top">
                        <p class="text-secondary mb-0" style="font-size: 14px;">
                            Nhấn nút bên dưới để thanh toán
                        </p>
                    </div>
                    <button class="btn btn-primary w-100 mt-3" onclick="goToPayment()">
                        Thanh toán lại
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Get status from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const paymentStatus = urlParams.get('payment');
        const accountStatus = urlParams.get('status') || 'active-recurring';
        
        function showStatus(status) {
            // Hide all status sections
            document.querySelectorAll('[id^="status-"]').forEach(el => {
                if (el.id.startsWith('status-')) {
                    el.classList.add('d-none');
                }
            });
            
            // Show selected status
            const statusMap = {
                'active-recurring': 'status-active-recurring',
                'active-no-recurring': 'status-active-no-recurring',
                'ended': 'status-ended'
            };
            
            const element = document.getElementById(statusMap[status] || 'status-active-recurring');
            if (element) {
                element.classList.remove('d-none');
            }
        }
        
        function showInvoice(type) {
            document.querySelectorAll('[id^="invoice-"]').forEach(el => {
                el.classList.add('d-none');
            });
            const invoice = document.getElementById(`invoice-${type}`);
            if (invoice) {
                invoice.classList.remove('d-none');
            }
        }
        
        // Initialize based on URL parameters
        if (paymentStatus === 'success') {
            showInvoice('success');
        } else if (paymentStatus === 'failed') {
            showInvoice('failed');
        } else {
            showInvoice('success');
        }
        
        showStatus(accountStatus);
        
        // Actions
        function stopSubscription() {
            if (confirm('Bạn có chắc muốn ngừng đăng ký?')) {
                alert('Đã ngừng đăng ký');
            }
        }
        
        function changePlan() {
            window.location.href = 'renew-plan.html?action=change-plan';
        }
        
        function cancelSubscription() {
            if (confirm('Bạn có chắc muốn hủy đăng ký? Hành động này không thể hoàn tác!')) {
                alert('Đã hủy đăng ký');
            }
        }
        
        function resubscribe() {
            window.location.href = 'renew-plan.html?action=renew';
        }
        
        function addSeat() {
            window.location.href = 'add-seat-checkout.html';
        }
        
        function removeUser(userId) {
            if (confirm('Bạn có chắc muốn xóa user này?')) {
                alert('Đã xóa user');
            }
        }
        
        function removeSeat(seatId) {
            if (confirm('Bạn có chắc muốn xóa seat này?')) {
                alert('Đã xóa seat');
            }
        }
        
        function assignUser(seatId) {
            const userName = prompt('Nhập tên user:');
            if (userName) {
                alert(`Đã gán user ${userName} vào seat`);
            }
        }
        
        function retryPayment() {
            window.location.href = 'payment.html';
        }
        
        function goToPayment() {
            window.location.href = 'payment.html';
        }
        
        function loginRequired() {
            alert('Vui lòng đăng nhập để tiếp tục');
        }
    </script>
</body>
</html>

